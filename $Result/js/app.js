"use strict";import{separateSelect}from"../../Modules/components.js";import{sliderCounter}from"../../Modules/components.js";import{isMobile}from"../../Modules/Regex.js";function clickOutside(t){document.addEventListener("click",(e=>{let c=e.target,r=null;"cart"===t?(r=cartCloseBtn.contains(c)||cartBody.contains(c)||cartIcon.contains(c),!r&&cartBody.classList.contains("_active")&&(document.body.classList.remove("_stop-scroll"),cartBody.classList.remove("_active"),header.classList.remove("_eclipse"))):"burger"===t&&(r=burgerBody.contains(c)||burgerIcon.contains(c),!r&&burgerBody.classList.contains("_active")&&(document.body.classList.remove("_stop-scroll"),burgerBody.classList.remove("_active"),burgerIcon.classList.remove("_active"),header.classList.remove("_eclipse")))}))}window.addEventListener("DOMContentLoaded",(()=>{}));let header=document.querySelector(".js-header"),burgerIcon=document.querySelector(".js-burger"),burgerBody=document.querySelector(".js-burger-body"),headerHeight=header.clientHeight,scrollPos=window.pageYOffset;function toFixHeader(){scrollPos=window.pageYOffset,scrollPos>headerHeight?header.classList.add("_fixed"):0==scrollPos&&header.classList.remove("_fixed")}burgerIcon.addEventListener("click",(t=>{t.preventDefault(),document.body.classList.toggle("_stop-scroll"),burgerBody.classList.toggle("_active"),burgerIcon.classList.toggle("_active"),header.classList.toggle("_eclipse"),clickOutside("burger")})),window.addEventListener("scroll",(()=>{toFixHeader()})),toFixHeader();let cartIcon=document.querySelector(".header__cart-icon"),cartBody=document.querySelector(".js-cart-header"),cartCloseBtn=cartBody.querySelector(".js-cart-close"),cartPreviewBtn=document.querySelector(".preview-cart__btn");cartIcon.addEventListener("click",(t=>{t.preventDefault(),document.body.classList.add("_stop-scroll"),cartBody.classList.add("_active"),header.classList.add("_eclipse"),clickOutside("cart"),cartCloseBtn.addEventListener("click",(t=>{t.preventDefault(),document.body.classList.remove("_stop-scroll"),cartBody.classList.remove("_active"),header.classList.remove("_eclipse")}))})),cartPreviewBtn.addEventListener("click",(t=>{t.preventDefault();let e=cartPreviewBtn.getAttribute("href"),c=document.querySelector(`${e}`);document.body.classList.remove("_stop-scroll"),cartBody.classList.remove("_active"),header.classList.remove("_eclipse"),c.scrollIntoView({behavior:"smooth",block:"start"})}));let pageURl,navLinks=document.querySelectorAll(".js-nav-link"),viewportWidth=window.innerWidth;for(let t of navLinks)t.addEventListener("click",(e=>{e.preventDefault();let c=t.getAttribute("href");function r(t){viewportWidth<=768&&header.classList.remove("_fixed"),document.querySelector(`${t}`).scrollIntoView({behavior:"smooth",block:"start"})}window.location.href.match(/index/g)?r(c):new Promise(((t,e)=>{window.location.href="../../index.html",window.addEventListener("load",(()=>{t(c)}))})).then((t=>{console.log("worked"),r(t)})).catch((t=>{console.log("Error:",t)}))}));let productsBtn=document.querySelector(".js-products-btn");async function getProducts(){if(!productsBtn.classList.contains("_hold")){productsBtn.classList.add("_hold");let t="Json/products.json",e=await fetch(t);try{uploadProducts((await e.json()).products),productsBtn.classList.remove("_hold")}catch{alert("Something was wrong...")}}}function uploadProducts(t){let e=document.querySelector(".js-products-body"),c=null,r=[],s=null,o=null;e.querySelector(".js-products-column")?(c=e.querySelectorAll(".js-products-column"),c.forEach((t=>{r.push(parseInt(t.dataset.pid))})),s=t.reduce(((t,e)=>(r.includes(e.id)?productsBtn.remove():t.push(e),t)),[])):s=t,o=s.length>=3?3:s.length;for(let t=0;t<o;t++){let c,r,o,n,i,d,a,l,u,p,_,m,v,h=s,f=h[t].id,g=h[t].url,y=h[t].image,b=h[t].name,L=h[t].sale,S=h[t].price,q=h[t].oldPrice,w=h[t].tastes;r=`\n            <article class="products__column js-products-column" data-pid="${f}">\n                <div class="products__item item-products">\n        `,a='<div class="item-products__content">',l=`\n            <a href="product-page.html" data-product-url="${g}" class="item-products__img"><img src="${y}" alt="Product"></a>\n        `,u=`<p class="item-products__text">${b}</p>`,1==L?(o='\n                <div class="item-products__sale sale">\n                    <div class="sale__star _icon-big-star"><p class="sale__text">SALE</p></div>\n                </div>\n            ',_="item-products__price_sale",m="item-products__subprice_sale"):(o="",_="",m=""),p=`\n            <p class="item-products__price ${_}"><span>${S}</span> грн</p>\n            <p class="item-products__subprice ${m}">${q} грн</p>\n        `,v="</div>",n=a,n+=l,n+=u,n+=p,n+=v;let P,j,$,B,x,E='<div class="item-products__actions">',A="",k="</div>",H='<div class="item-products__tastes">',M='<div class="item-products__select item-products-select js-select-item-products">',I="",T="</div>",C="</div>";j='\n            <div class="item-products-select__label js-label">\n                <div class="item-products-select__title js-title">Выбрать вкус</div>\n                <div class="item-products-select__btn js-btn _icon-select-arrow"></div>\n            </div>\n        ',B='<div class="item-products-select__options js-options">',w.forEach((t=>{I+=`<div class="item-products-select__option js-option">${t}</div>`})),x="</div>",$=B,$+=I,$+=x,A+=H,A+=M,A+=j,A+=$,A+=T,A+=C,P='\n            <a href="" class="item-products__btn btn">\n                <p class="item-products__label btn__text">Добавить</p>\n                <div class="item-products__icon _icon-cart btn__icon"></div>\n            </a>\n        ',i=E,i+=A,i+=P,i+=k,d="</div></article>",c=r,c+=o,c+=n,c+=i,c+=d,e.insertAdjacentHTML("beforeend",c)}document.querySelectorAll(".js-products-column").forEach((t=>{let e=t.dataset.pid;separateSelect(`[data-pid="${e}"] .js-select-item-products`)})),e.addEventListener("click",(t=>{if(t.preventDefault(),t.target.closest(".item-products__img")){let e=t.target.closest(".item-products__img"),c=e.dataset.productUrl,r=`${e.getAttribute("href")}?id=${c}`,s=null;s=isMobile()?"_self":"_blank",window.open(r,s)}}))}productsBtn.addEventListener("click",(t=>{t.preventDefault(),getProducts()})),getProducts();let productsParent=document.querySelector(".js-products-body"),currentProductWrapper=null,currentProductId=null,currentProduct=null,currentBtn=null;function pushProduct(t,e,c,r){if(e.classList.contains("_added")){let e=t.getBoundingClientRect(),s=e.top+window.pageYOffset+e.height/2,o=e.left+window.pageXOffset+e.width/2,n=c.querySelector("img"),i=n.cloneNode(),d=n.getBoundingClientRect(),a=d.width,l=d.height,u=d.top+window.pageYOffset,p=d.left+window.pageXOffset;i.setAttribute("class","_fly-image"),i.style.cssText=`\n            width: ${a}px;\n            height: ${l}px;\n            position: absolute;\n            top: ${u}px;\n            left: ${p}px;\n        `,document.body.append(i),i.animate([{width:`${a}px`,height:`${l}px`,top:`${u}px`,left:`${p}px`,opacity:1},{width:"0px",height:"0px",top:`${s}px`,left:`${o}px`,opacity:0}],{duration:1e3,easing:"ease-in-out"}).onfinish=()=>{i.remove();let e=t.querySelector("span"),c=r.length;e.innerHTML=c}}}function uploadAmountSection(t){if(t.length>0){let e=document.querySelector(".js-cart-header"),c=document.querySelector(".cart-header__products");e.classList.remove("_empty"),t.forEach((t=>{let e=t.dataset.cartPid;separateSelect(`[data-cart-pid="${e}"] .js-select-item-products-cart`)}));let r='\n            <div class="cart-products__amount amount-products">\n                <div class="amount-products__price">\n                    <p class="amount-products__title">Итого:</p>\n                    <p class="amount-products__sum"><span>0</span> грн</p>\n                </div>\n                <p class="amount-products__text">Бесплатная доставка на сумму от 1500 грн.</p>\n                <a href="formalize-page.html" class="amount-products__btn btn">\n                    <p class="amount-products__label btn__text">Оформить заказ</p>\n                    <div class="amount-products__icon _icon-common-arrow btn__icon"></div>\n                </a>\n            </div>\n        ';c.classList.contains("_common-amount")||(c.insertAdjacentHTML("beforeend",r),c.classList.add("_common-amount"));for(let s=0;s<t.length;s++){let o=t[s],n=`[data-cart-pid="${o.dataset.cartPid}"] .js-counter-slider`,i=o.querySelector(".cart-item-products__price"),d=i.querySelector("span"),a=parseInt(i.dataset.cartProductPrice),l=document.querySelector(".amount-products__sum span");function u(t){let e=t;d.innerHTML=a*e;let c=document.querySelectorAll(".cart-item-products__price span"),r=0;c.forEach((t=>{r+=parseInt(t.innerHTML),l.innerHTML=r}))}sliderCounter(n,10,"0.3s",u)}}else cartWrapper.classList.add("_empty")}function checkCart(t){let e=document.querySelector(`[data-cart-pid="${t}"]`);document.querySelector(".js-cart-header"),document.querySelectorAll(".cart-products__item");if(e){let t=currentBtn.querySelector(".item-products__label"),e=currentBtn.querySelector(".item-products__icon");t.innerHTML="Добавлено",e.setAttribute("class","item-products__icon _icon-added btn__icon")}}function removeCartProduct(){document.querySelectorAll(".cart-products__item").forEach((t=>{t.querySelector(".cart-item-products__remove").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation();let c=t,r=c.dataset.cartPid,s=document.querySelector(`[data-pid="${r}"]`).querySelector(".item-products__btn"),o=s.querySelector(".item-products__label"),n=s.querySelector(".item-products__icon"),i=document.querySelector(".amount-products__sum span");o.innerHTML="Добавить",n.setAttribute("class","item-products__icon _icon-cart btn__icon"),s.classList.remove("_added"),c.remove(),changeCommonPrice(i)}))}))}function changeCommonPrice(t){let e=document.querySelectorAll(".cart-item-products__price span"),c=document.querySelectorAll(".cart-products__item"),r=document.querySelector(".cart-header__products"),s=document.querySelector(".cart-products__amount"),o=document.querySelector(".js-cart-header"),n=0,i=document.querySelector(".header__cart-icon span");0==c.length&&s?(s.remove(),r.classList.remove("_common-amount"),o.classList.add("_empty")):e.forEach((e=>{n+=parseInt(e.innerHTML),t.innerHTML=n})),i.innerHTML=c.length}function formalizeProducts(t){document.querySelector(".amount-products__btn").addEventListener("click",(e=>{e.preventDefault();let c=t.map((t=>`id=${t}`)).join("&");window.open(`formalize-page.html?${c}`,"_self")}))}productsParent.addEventListener("click",(t=>{if(t.preventDefault(),t.target.classList.contains("item-products__btn")&&!t.target.classList.contains("_added")){currentBtn=t.target,currentProduct=currentBtn.closest(".products__item"),currentProductWrapper=currentBtn.closest(".js-products-column"),currentProductId=currentProductWrapper.dataset.pid;let e=currentProduct.querySelector(".item-products__img"),c=currentProduct.querySelector(".item-products__img"),r=currentProduct.querySelector(".item-products__img img"),s=currentProduct.querySelector(".item-products__text"),o=currentProduct.querySelector(".item-products-select__title"),n=currentProduct.querySelectorAll(".item-products-select__option"),i=currentProduct.querySelector(".item-products__price span"),d=r.getAttribute("src"),a=s.innerHTML,l=o.innerHTML,u=[],p=i.innerHTML;n.forEach((t=>{u.push(t.innerHTML)}));let _,m,v,h,f,g,y=document.querySelector(".header__cart-icon"),b=document.querySelector(".js-cart-products-items"),L=`<div class="cart-products__item cart-item-products" data-cart-pid="${currentProductId}">`,S="</div>",q='<div class="cart-item-products__info">',w="",P="</div>",j='<div class="cart-item-products__picture">',$=c.dataset.productUrl;f=`${c.getAttribute("href")}?id=${$}`,g=`<a href="${f}" class="cart-item-products__img"><img src="${d}" alt=""></a>`,w+=j,w+=g,w+="</div>";let B,x,E='<div class="cart-item-products__subinfo">',A=`<p class="cart-item-products__text">${a}</p>`,k="</div>",H='\n            <div class="cart-item-products__select cart-item-products-select js-select-item-products-cart">\n        ',M=`\n                <div class="cart-item-products-select__label js-label">\n                    <div class="cart-item-products-select__title js-title">${l}</div>\n                    <div class="cart-item-products-select__btn js-btn _icon-select-arrow"></div>\n                </div>\n            `,I="</div>",T='<div class="cart-item-products-select__options js-options">',C="",D="</div>";u.forEach((t=>{C+=`<div class="cart-item-products-select__option js-option">${t}</div>`})),x=T,x+=C,x+=D,B=H,B+=M,B+=x,B+=I,h=E,h+=A,h+=B,h+=k,m=q,m+=w,m+=h,m+=P;let O,W=`\n                <div class="cart-item-products__price" data-cart-product-price="${p}">\n                    <span>${p}</span> грн.\n                </div>\n            `;O='<div class="cart-item-products__counter-info">',O+='\n                <div class="cart-item-products-counter js-counter-slider" data-counter-number="0">\n                    <div class="cart-item-products-counter__body">\n                        <div class="cart-item-products-counter__item cart-item-products-counter__item_minus _icon-minus js-minus"></div>\n                        <div class="cart-item-products-counter__item cart-item-products-counter__item_number js-number"></div>\n                        <div class="cart-item-products-counter__item cart-item-products-counter__item_plus _icon-plus js-plus"></div>\n                    </div>\n                </div>\n            ',O+=W,O+="</div>",v='<div class="cart-item-products__actions">',v+='<a href="" class="cart-item-products__remove"><span>Удалить</span></a>',v+=O,v+="</div>",_=L,_+=m,_+=v,_+=S,currentBtn.classList.add("_added"),b.insertAdjacentHTML("beforeend",_);let z=document.querySelectorAll(".cart-products__item"),R=[];z.forEach((t=>{R.push(t.dataset.cartPid)})),pushProduct(y,currentBtn,e,z),uploadAmountSection(z),checkCart(currentProductId),removeCartProduct(),formalizeProducts(R)}}));
